<!-- home.html -->
<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æˆ‘çš„ç½‘ç«™ä¸»é¡µ</title>
  <link rel="stylesheet" href="static/homestyle.css">

  <!-- ğŸ” å¼•å…¥å…¨å±€è®¤è¯æ¨¡å— -->
  <script src="/static/AuthManager.js" defer></script>
</head>

<body>
  <!-- å…¬å‘Šæ  -->
  <div class="announcement-bar">
    ğŸ‰ æ–°ç”¨æˆ·æ³¨å†Œäº«é¦–æœˆå…è´¹ä½“éªŒï¼
    <a href="/promo">ç«‹å³æŸ¥çœ‹æ´»åŠ¨è¯¦æƒ…</a>
  </div>

  <!-- å¯¼èˆªæ  -->
  <nav class="navbar">
    <img class="logo" src="static/liuying.png" width="60px">
    <ul class="nav-links">
      <li><a href="/">é¦–é¡µ</a></li>
      <li><a href="/about">å…³äº</a></li>
      <li class="dropdown">
        <a>æœåŠ¡ â–¼</a>
        <ul class="dropdown-content">
          <li><a href="#" class="protected-link" data-href="/room">å­¦é™¢èŠå¤©å®¤</a></li>
          <li><a href="#" class="protected-link" data-href="/ai">AIèŠå¤©</a></li>
        </ul>
      </li>
      <li><a href="/contact">è”ç³»</a></li>
    </ul>
    <div class="auth-buttons">
      <!-- ç™»å½•/ç™»å‡ºæŒ‰é’®å°†ç”± JS åŠ¨æ€æ§åˆ¶ -->
      <button id="auth-btn" class="btn btn-login">åŠ è½½ä¸­...</button>
    </div>
  </nav>

  <!-- ä¸»ä½“å†…å®¹ -->
  <div class="container">
    <header>
      <h1>æ¬¢è¿æ¥åˆ° "æˆ‘çš„AI"</h1>
      <p class="lead">æˆ‘ä»¬è‡´åŠ›äºä¸ºæ‚¨æä¾›æœ€ä¼˜è´¨çš„æœåŠ¡ä¸ä½“éªŒï¼Œè®©æ‚¨çš„æ¯ä¸€å¤©éƒ½æ›´é«˜æ•ˆã€æ›´è½»æ¾ã€‚</p>
    </header>
  </div>

  <!-- âœ… æ·»åŠ è„šæœ¬ï¼šæ‹¦æˆªå—ä¿æŠ¤é“¾æ¥ -->
  <script>
    function checkTokenOnHome() {
      const user_info = localStorage.getItem("isAuthenticated")

      const authBtn = document.getElementById("auth-btn");

      if (user_info) {
        authBtn.textContent = "ç™»å‡º";
        authBtn.onclick = function () {
          if (confirm("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ")) {
            localStorage.removeItem("account");
            localStorage.removeItem("isAuthenticated");
            alert("å·²é€€å‡ºç™»å½•");
            location.reload();
          }
        };

        // è§£æ JWT payloadï¼ˆä»…ç”¨äºæ˜¾ç¤ºä¿¡æ¯ï¼Œä¸ç”¨äºå®‰å…¨åˆ¤æ–­ï¼‰
        try {
          const user_info = localStorage.getItem("account")
          console.log("å½“å‰ç”¨æˆ· è´¦å·:", user_info);
        } catch (e) {
          console.warn("æ— æ³•è§£æ localStorage", e);
        }

      } else {
        authBtn.textContent = "ç™»å½•/æ³¨å†Œ";
        authBtn.onclick = () => window.location.href = "/login";
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
    document.addEventListener("DOMContentLoaded", () => {
      checkTokenOnHome();

      // ä¿®å¤ protected-link é€»è¾‘
      document.querySelectorAll(".protected-link").forEach(link => {
        link.addEventListener("click", function (e) {
          const user_info = localStorage.getItem("isAuthenticated");
          const targetUrl = this.getAttribute("data-href");
          if (!user_info && targetUrl && !targetUrl.startsWith("/") && !targetUrl.startsWith("#")) {
            e.preventDefault();
            alert("è¯·å…ˆç™»å½•ï¼");
            window.location.href = "/login";
          }
          else{
            window.location.href = targetUrl;
          }
        });
      });
    });
  </script>
</body>

</html>